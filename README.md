# 前言
上传的第二版
- 解决了RabbitMQ多容器配置的问题，解决了相关的并发问题。
- 简单地赋予了项目对于登陆的客户初筛，其是否具有秒杀商品的资格。未来可能有扩展。
- 前端换了一些静态文件，关于后台管理系统的前端，准备放到未来与秒杀系统一并构建前后端分离的项目。

# 简介
针对需求，本项目使用了基于Java微服务的解决方案，采用了SpringBoot框架、SpringCloud微服务架构、SpringCloud Gateway网关技术栈、SpringCloud alibaba技术栈、SpringCloud Netflix技术栈、持久层MybatisPlus框架、中间件缓存Redis与Redisson框架、中间件消息队列RabbitMQ等一系列技术栈，优化项目中的消息队列与缓存等技术，解决了秒杀系统设计与实现中，并发不安全的难题与数据库存储的瓶颈。微服务构架技术，则赋予了项目需要的容灾性和可扩展性，从而完成了一个具有高并发、高可用性能的秒杀系统以及灵活配置秒杀业务与策略的秒杀系统。

# 如何使用
- 首先将SQL导入自己的数据库，用户名root、密码123456即可。Mysql的表名得是SQL文件名。
- 启动Nacos，如果没有则先安装，安装后按网上文章博客启动。
- 启动本地的Redis，密码要配置为123456即可。如果本地没有安装Redis，则先安装。
- 启动本地的RabbitMQ，用户名和密码才去默认即可。如果本地没有安装RabbitMQ，则先安装。
- 依次启动项目中的cloud-gateway、cloud-uaa、cloud-mission、cloud-manage模块，如果不用到后台管理系统可以不启动cloud-manage模块。
- 其中参数都可以了解后自行在项目里更改。

# 秒杀的代码逻辑
- 关于秒杀的业务逻辑，用户访问，在uaa模块登入时，进行资格筛选，认证后。进入秒杀商品列表页面，点入秒杀商品详情后，点击立即秒杀，如果在规定时间内（按钮没有置灰），并且没有重复秒杀，则开启秒杀。
- 这里涉及到秒杀接口的URL加盐动态化，后端相关的秒杀代码，没有选择Redis的LUA脚本和Redisson分布式锁，因为项目中没有使用过多的Redis事务逻辑和Redis分布式逻辑。秒杀主要运用的是：Mysql加上乐观锁和Redis库存预热加载和Redis预减库存解决超卖；RabbitMQ消息队列使用串行化，保证项目的高可用和高并发。
- 秒杀的策略配置以及登陆初筛等功能，都是由manage模块使用feign技术栈来调用服务与服务之间来完成事务的。

# 解决的疑难杂症
- 当使用网关时，静态资源可以放网关下，如果是分别放下游服务静态资源包中，需要在代码中的js、css和img的路径加上/static/，和gateway配置中路径加上 /static/
- 当页面静态化与controller层映射时，超过两层的映射路径 /user/login 返回的字符串必须要有斜线/ 而如果只有一层则不需要。摒弃了"redirect:/login.html" 那种情况
- Swagger依赖版本可能会导致报错，doc.html页面功能需要另外加个依赖
- 使用MP框架时，想要切换主键生成策略，那么在切换之前，最好对数据库表执行"TRUNCATE TABLE 'table name'" 操作，不然会有影响。
- Druid 1.1.21以下的版本与MQ有冲突，高版本没有。1.1.22比较合适，更高版本的另外报错warn,连接失败。
- Feign调用接口如果要传递参数，必须要用@RequestParam注解
- Mysql Order是关键字，不能用来作为表名。
- RabbitMQ 开启多实例容器工厂配置来代替单实例配置后，在消费者中需要手动进行确认消费。并且比起使用单实例模式，一些地方可能出现并发问题，比如更新秒杀库存表。这里使用即时读取Redis库存数字，写入缓存库存数字来试着解决。

# 未来展望
- 前端的一些改进，或者改用前后端分离框架如React、Vue；前端也拥有自己的服务器，还可以用上cdn加速。
- Nginx对于Redis的分布式的一些配置未来也可以用上，Nginx均衡负载，集群分布式等，增加高可用的程度。
- 数据库的容灾，可以在云数据库厂商直接配置。主从结构，定时备份。也可以用容器构建。集群部署，主从分离，定时备份。
- 本身项目中秒杀模块也有注解加拦截器负责限流。关于限流、熔断等功能，还可以由网关来承载，这可能是未来改进的一个方向，暂且先不添加这方面的逻辑和功能。
- 实现可流程配置，针对个性化业务实现免开发上线。配置项如下:拦截规则中的准入要求，秒杀活动中的产品份数、秒杀开启时间、每份产品金额
- 后台管理系统的优化与扩展。
- 数据库需要有容灾性，或是用备份方案，不能流量涌入就让数据库挂掉。这个需要体现。
- 项目介绍、详细方案、演示视频、简介PPT、与其他相关材料。